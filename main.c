#include <stdio.h>
#include <stdlib.h>
#include <Windows.h>
#include <conio.h>

#define REN 16
#define COL 16

extern int funciones_laberinto(char *mapa, int ren, int col, char tecla);

void pantalla_bienvenida();
int menu();
int display();

int main() {
    int op = 0;
    SetConsoleOutputCP(CP_UTF8);
    pantalla_bienvenida();

    do {
        if (op != 1) {
            op = menu();
        }

        if (op != 2) {
            op = display();
        }

    } while (op != 2);

    printf("\n\n\n\n██╗░░██╗░█████╗░░██████╗████████╗░█████╗░      ██╗░░░░░██╗░░░██╗███████╗░██████╗░░█████╗░\n");
    printf("██║░░██║██╔══██╗██╔════╝╚══██╔══╝██╔══██╗      ██║░░░░░██║░░░██║██╔════╝██╔════╝░██╔══██╗\n");
    printf("███████║███████║╚█████╗░░░░██║░░░███████║      ██║░░░░░██║░░░██║█████╗░░██║░░██╗░██║░░██║\n");
    printf("██╔══██║██╔══██║░╚═══██╗░░░██║░░░██╔══██║      ██║░░░░░██║░░░██║██╔══╝░░██║░░╚██╗██║░░██║\n");
    printf("██║░░██║██║░░██║██████╔╝░░░██║░░░██║░░██║      ███████╗╚██████╔╝███████╗╚██████╔╝╚█████╔╝\n");
    printf("╚═╝░░╚═╝╚═╝░░╚═╝╚═════╝░░░░╚═╝░░░╚═╝░░╚═╝      ╚══════╝░╚═════╝░╚══════╝░╚═════╝░░╚════╝░\n");
    Sleep(1000);
    system("cls");
    return 0;
}

void pantalla_bienvenida() {
    system("cls");
    printf("██╗░░░░░░█████╗░██████╗░███████╗██████╗░██╗███╗░░██╗████████╗░█████╗░\n");
    printf("██║░░░░░██╔══██╗██╔══██╗██╔════╝██╔══██╗██║████╗░██║╚══██╔══╝██╔══██╗\n");
    printf("██║░░░░░███████║██████╦╝█████╗░░██████╔╝██║██╔██╗██║░░░██║░░░██║░░██║\n");
    printf("██║░░░░░██╔══██║██╔══██╗██╔══╝░░██╔══██╗██║██║╚████║░░░██║░░░██║░░██║\n");
    printf("███████╗██║░░██║██████╦╝███████╗██║░░██║██║██║░╚███║░░░██║░░░╚█████╔╝\n");
    printf("╚══════╝╚═╝░░╚═╝╚═════╝░╚══════╝╚═╝░░╚═╝╚═╝╚═╝░░╚══╝░░░╚═╝░░░░╚════╝░\n\n");
    printf("Presiona ENTER para comenzar...\n");
    getchar();
}

int menu() {
    int resp = 0;
    system("cls");
    printf("╔══════════════════════════════════════╗\n");
    printf("║          JUEGO DEL LABERINTO         ║\n");
    printf("╠══════════════════════════════════════╣\n");
    printf("║  1. Empezar                          ║\n");
    printf("║  2. Salir                            ║\n");
    printf("╚══════════════════════════════════════╝\n");
    printf("Seleccione una opción: ");
    fflush(stdin);
    scanf("%d", &resp);
    Sleep(1000);
    system("cls");
    return resp;
}

int display() {
    char tecla;

    char mapa[REN][COL] = {
        {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'},
        {'#','P','.','.','.','.','.','.','.','.','.','.','.','.','.','#'},
        {'#','.','#','#','#','.','#','.','#','#','#','#','#','#','.','#'},
        {'#','.','.','.','#','.','#','.','.','.','.','.','.','#','.','#'},
        {'#','#','#','.','#','.','#','#','#','#','#','#','.','#','.','#'},
        {'#','.','#','.','.','.','.','.','.','.','.','#','.','#','.','#'},
        {'#','.','#','#','#','#','#','#','#','#','.','#','.','#','.','#'},
        {'#','.','.','.','.','.','.','.','#','#','.','#','.','#','.','#'},
        {'#','#','#','#','#','#','#','.','#','.','.','#','.','#','.','#'},
        {'#','.','.','.','.','.','#','.','#','#','#','#','.','#','.','#'},
        {'#','.','#','#','#','.','#','.','.','.','.','.','.','#','.','#'},
        {'#','.','#','.','.','.','#','#','#','#','#','#','#','#','.','#'},
        {'#','.','#','.','#','.','.','.','.','.','.','.','.','.','.','#'},
        {'#','.','#','.','#','#','#','#','#','#','#','#','#','#','#','#'},
        {'#','.','.','.','.','.','.','.','.','.','.','.','.','.','X','#'},
        {'#','#','#','#','#','#','#','#','#','#','#','#','#','#','#','#'}
    };

    do {
        for (int i = 0; i < REN; i++) {
            for (int j = 0; j < COL; j++) {
                printf(" %c", mapa[i][j]);
            }
            printf("\n");
        }
        printf("\n||| Usa W/A/S/D para moverte |||");
        printf("\n        R para reiniciar");
        printf("\n         E para salir\n\n");

        tecla = getch();

        if (tecla == 'w' || tecla == 'a' || tecla == 's' || tecla == 'd') {
            Beep(750, 50);
        } else if (tecla == 'r') {
            Beep(500, 150);
        } else if (tecla == 'e') {
            Beep(1000, 150);
        }

        if (tecla == 'r') {
            system("cls");
            Sleep(800);
            return 1;
        }

        int resultado = funciones_laberinto((char *)mapa, REN, COL, tecla);    

        if (resultado == 1) {
            Sleep(800);
            system("cls");
            printf("░██████╗░░█████╗░███╗░░██╗░█████╗░░██████╗████████╗███████╗\n");
            printf("██╔════╝░██╔══██╗████╗░██║██╔══██╗██╔════╝╚══██╔══╝██╔════╝\n");
            printf("██║░░██╗░███████║██╔██╗██║███████║╚█████╗░░░░██║░░░█████╗░░\n");
            printf("██║░░╚██╗██╔══██║██║╚████║██╔══██║░╚═══██╗░░░██║░░░██╔══╝░░\n");
            printf("╚██████╔╝██║░░██║██║░╚███║██║░░██║██████╔╝░░░██║░░░███████╗\n");
            printf("░╚═════╝░╚═╝░░╚═╝╚═╝░░╚══╝╚═╝░░╚═╝╚═════╝░░░░╚═╝░░░╚══════╝\n\n");
            Sleep(1500);
            system("cls");
            return 0;
        }

        system("cls");

    } while (tecla != 'e');

    system("cls");
    Sleep(800);
    return 2;
}
